-# This file is part of Thinks.

-# Thinks is free software: you can redistribute it and/or modify
-# it under the terms of the GNU Affero Public License as published by
-# the Free Software Foundation, either version 3 of the License, or
-# (at your option) any later version.

-# Thinks is distributed in the hope that it will be useful,
-# but WITHOUT ANY WARRANTY; without even the implied warranty of
-# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-# GNU Affero Public License for more details.

-# You should have received a copy of the GNU Affero Public License
-# along with Thinks.  If not, see <http://www.gnu.org/licenses/>.

-# Copyright (c) 2015,2018 Claudio Maradonna

= render partial: 'shared/filters/layout', locals: { local_filters: [], local_model: :goals, local_text_field_name: 'search_title_and_description' }

%table.table.table-sm.table-hover#filterrific_results
  %thead.d-none
    %tr
      %td.col-11
      %td.col-1
  %tbody
    - unless smart_listing.empty?
      - smart_listing.collection.each do |goal|
        %tr
          %td
            %strong.d-none.d-md-block
              = link_to goal.title, goal_path(goal)
            %strong.d-sm-none
              = link_to goal.title.truncate(50), goal_path(goal), :title => goal.title
            %strong.d-none.d-sm-block.d-md-none
              = link_to goal.title, goal_path(goal)
            .text-dark.break-word
              %em
                = highlights_searched_text(plain_text(goal.description).truncate(150), @search)
              .progress{ style: 'height: 1.5rem;' }
                .progress-bar{"aria-valuemax" => "100", "aria-valuemin" => "0", "aria-valuenow" => "#{goal.progress}", :class => "#{progress_bar_color(goal.progress)}", :role => "progressbar", :style => "min-width: 3em; width: #{goal.progress}%;"}
                  = goal.progress
                  \%
          %td.border-left.align-middle
            %a.btn{ :class => goal.tasks.empty? ? "disabled" : "", :href => goal.tasks.empty? ? "javascript:;" : project_tasks_path(goal.project, "filterrific[with_goal]" => goal), :title => tasks_title(goal) , :role => "button" }
              = icon('fas', 'tasks')
    - else
      %tr.warning
        %td.text-center
          %strong
            No records found

= smart_listing.paginate
= smart_listing.pagination_per_page_links
