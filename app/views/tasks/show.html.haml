.form-group
  %h1.chapter-title
    = @task.title

    = link_to_button(edit_task_path(@task), "edit", "edit")
    = link_to_button(project_tasks_path(@task.project), "back", "arrow-left")
  %p.dark-grey
    %strong
      \##{@task.serial}
    created at #{@task.created_at.to_s(:long)} by #{@task.thinker.name}
  
.row
  .col-sm-4
    .panel.panel-default
      .panel-body
        %h4
          %strong
            = label_tag t('tasks.status'), nil, class: "control-label"
        %h4
          = @task.status.translation_code
    .panel.panel-default
      .panel-body
        %h4
          %strong
            = label_tag t('tasks.workload'), nil, class: "control-label"
        %h4
          = workload_description(@task.workload)
    .panel.panel-default
      .panel-body
        %h4
          %strong
            = label_tag t('tasks.worker'), nil, class: "control-label"
        - if !@task.worker.nil?
          %h4
            = @task.worker.name
        - elsif @task.status == @status_sprint
          - if @task.project.workers.active.include?(current_thinker)
            %h4 No one is working over this but you have yet something to do ;-P
          - else
            = link_to "Assigns me", assign_task_path, :method => :put, :class => "btn btn-success btn-block"
        - else
          %h4 Actually the team didn't decide to work on. Talk about if you are interested
  .col-sm-8
    .panel.panel-default
      .panel-body
        %h4
          %strong
            Descrizione
        = markdown(@task.description)
      %ul.list-group
        - if @comments.empty?
          = content_tag(:li, t("no_comments"), :class => "list-group-item")
        - @comments.each do |comment|
          = content_tag(:li, :class => "list-group-item #{comment.approved ? 'list-group-item-success' : ''}") do
            - if @task.worker == current_thinker
              %a.pull-right.btn{ :href => "", :title => "", :role => "button" }
                %span.glyphicon.glyphicon-ok{ "aria-hidden" => "true", :class => "#{ comment.approved ? '' : 'dark-grey' }" }
            = link_to comment.current_thinker?(current_thinker) || !comment.likes.current_thinker(current_thinker).empty? ? 'javascript:;' : comment_likes_path(comment), :class => "pull-right btn", :role => "button", :title => comment.current_thinker?(current_thinker) ? t("you_voted_yet") : "", method: :post do
              %span.glyphicon.glyphicon-arrow-up{ "aria-hidden" => "true", :class => "#{ comment.current_thinker?(current_thinker) || !comment.likes.current_thinker(current_thinker).empty? ? 'dark-grey' : '' }" }
              %span
                = like_count(comment.likes.length)
            .dark-grey
              = link_to("Comment", "#collapseComment#{ comment.id }", "data-toggle" => "collapse")
              by
              %strong
                #{comment.thinker.name}
            %small
              #{comment.created_at.to_s(:long)}
            .collapse{ :id => "collapseComment#{ comment.id }" }
              .form-group
              = comment.text
      .panel-footer
        = form_for [@task, @comment] do |f|
          .form-group
            = f.label :text, t(".your_small_thought_about"), :class => "control-label"
            = f.text_area(:text, :class => "form-control")
            %span#help-text.help-block= t "char_limit", chars: @chars_max_comment
          = f.submit t("submit"), :class => "btn btn-primary"
