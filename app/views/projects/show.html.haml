-# This file is part of Thinks.

-# Thinks is free software: you can redistribute it and/or modify
-# it under the terms of the GNU Affero Public License as published by
-# the Free Software Foundation, either version 3 of the License, or
-# (at your option) any later version.

-# Thinks is distributed in the hope that it will be useful,
-# but WITHOUT ANY WARRANTY; without even the implied warranty of
-# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-# GNU Affero Public License for more details.

-# You should have received a copy of the GNU Affero Public License
-# along with Thinks.  If not, see <http://www.gnu.org/licenses/>.

-# Copyright (c) 2015, Claudio Maradonna

- model_class = Project

- content_for :page_actions do
  - if creator?(@project.thinker.id)
    = link_to edit_project_path(@project), :class => 'list-group-item list-group-item-action' do
      = icon('fas', 'edit')
      %span= t('edit')
  - if current_thinker.present?
    %a.list-group-item.list-group-item-action{ type: "button", href: '#modal-contribution', "data-toggle": "modal" }
      = icon('fas', 'hands-helping')
      %span= t "projects.participation_preferences"
    = render partial: 'modal_contribution_preferences'
  - if @project.donate_button.present?
    %li.d-block.d-md-none.list-group-item
      %div{ style: 'margin-top: 15px;' }
        = @project.donate_button.html_safe
  - if @project.subprojects.exists?
    %li.nav-item.dropdown.float-left
      %a.nav-link.line-height-25.line-height-35#dropdown-subprojects{ type: :button, "data-toggle" => :dropdown, "aria-haspopup" => :true, "aria-expanded" => :false, href: "javascript:;" }
        = icon('fas', 'sitemap', :class => "fa-lg")
        %span.hidden-xs
          Subprojects
        %span.caret
      %ul.scrollbar.dropdown-menu.dropdown-mobile{ "aria-labelledby" => "dropdown-subprojects", style: 'max-height: 400px;' }
        - @project.subprojects.order(:title).each do |subproject|
          %li
            = link_to project_path(subproject) do
              - if subproject.logo
                = cl_image_tag(subproject.logo.path, { size: '20x20' })
              - else
                = icon('fas', 'folder')
              %span=subproject.title

.container-fluid
  .row
    .col-md-2.col-lg-2.pt-3.pb-3.pl-0.pr-0.border-right
      = render :partial => 'shared/projectbar', locals: { project: @project }
    .col-md-8.col-lg-8.pt-3.pb-3
      = render :partial => "shared/breadcrumbs", locals: { project: @project }
      .row
        .col-md-10
          %h3
            = @project.title
            \-
            %small.font-italic
              = @project.motto
          .text-justify
            = cl_image_tag(@project.logo.path, { size: '200x200', class: 'pull-left project-img', style: 'margin-right: 25px;' }) if @project.logo
            = markdown(@project.description)
        .col-md-2.d-none
          %h4.font-bold
            = t ".projects.list.progress"
          .progress
            %div{"aria-valuemax" => "100", "aria-valuemin" => "0", "aria-valuenow" => "#{@project.progress_percentage}", :class => "progress-bar #{progress_bar_color(@project.progress_percentage)}", :role => "progressbar", :style => "min-width: 2em; width: #{@project.progress_percentage}%;"}
              = @project.progress_percentage
              \%
          = t('projects.goal_completed')
          .row.margin-top-15
            .col-md-4
              %label.control-label
                = t ".team"
              .scrollbar{ style: 'max-height: 450px;' }
                %table.table.table-condensed
                  %tbody
                    %tr
                      %td
                        = @project.thinker.name
                        (
                        %strong.font-italic
                          = t "founder"
                        )
                    - @project.team.each do |contribution|
                      %tr
                        %td
                          = contribution.thinker.name
            .col-md-4
              %label.control-label
                = t ".current_goal"
              .scrollbar{ style: 'max-height: 450px;' }
            .col-md-4
              %label.control-label
                = t ".workload_in_time"
              .scrollbar{ style: 'max-height: 450px;' }

    .col-md-2.col-lg-2.pt-3.pb-3.pl-0.pr-0.border-left
      = render :partial => 'shared/projectdetails', locals: { project: @project }
