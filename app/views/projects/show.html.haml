-# This file is part of Thinks.

-# Thinks is free software: you can redistribute it and/or modify
-# it under the terms of the GNU Affero Public License as published by
-# the Free Software Foundation, either version 3 of the License, or
-# (at your option) any later version.

-# Thinks is distributed in the hope that it will be useful,
-# but WITHOUT ANY WARRANTY; without even the implied warranty of
-# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-# GNU Affero Public License for more details.

-# You should have received a copy of the GNU Affero Public License
-# along with Thinks.  If not, see <http://www.gnu.org/licenses/>.

-# Copyright (c) 2015, Claudio Maradonna

- model_class = Project

- if !@project.has_goals?
  - content_for :page_modals do
    = render partial: 'projects/modal_create_goal'


- content_for :page_actions do
  - if current_thinker.present?
    %li.nav-item.ml-1
      %a.btn.btn-default{ type: "button", href: '#modal-contribution', "data-toggle": "modal" }
        = icon('fas', 'hands-helping')
        %span= t "projects.participation_preferences"
  - if creator?(@project.thinker.id)
    %li.nav-item.ml-1
      = link_to edit_project_path(@project), :class => 'btn btn-primary' do
        = icon('fas', 'edit')
        %span= t('edit')
  - if @project.donate_button.present?
    %li.d-block.d-md-none.list-group-item
      %div{ style: 'margin-top: 15px;' }
        = @project.donate_button.html_safe
  - if @project.subprojects.exists?
    %li.nav-item.dropdown.float-left
      %a.nav-link.line-height-25.line-height-35#dropdown-subprojects{ type: :button, "data-toggle" => :dropdown, "aria-haspopup" => :true, "aria-expanded" => :false, href: "javascript:;" }
        = icon('fas', 'sitemap', :class => "fa-lg")
        %span.hidden-xs
          Subprojects
        %span.caret
      %ul.scrollbar.dropdown-menu.dropdown-mobile{ "aria-labelledby" => "dropdown-subprojects", style: 'max-height: 400px;' }
        - @project.subprojects.order(:title).each do |subproject|
          %li
            = link_to project_path(subproject) do
              - if subproject.logo
                = cl_image_tag(subproject.logo.path, { size: '20x20' })
              - else
                = icon('fas', 'folder')
              %span=subproject.title

- content_for :page_content do
  .row
    .col-md-10
      %h3
        = @project.title
        \-
        %small.font-italic
          = @project.motto
      .text-justify
        = cl_image_tag(@project.logo.path, { size: '200x200', class: 'pull-left project-img', style: 'margin-right: 25px;' }) if @project.logo
        = markdown(@project.description)
    .col-md-2.d-none
      %h4.font-bold
        = t ".projects.list.progress"
      .progress
        %div{"aria-valuemax" => "100", "aria-valuemin" => "0", "aria-valuenow" => "#{@project.progress_percentage}", :class => "progress-bar #{progress_bar_color(@project.progress_percentage)}", :role => "progressbar", :style => "min-width: 2em; width: #{@project.progress_percentage}%;"}
          = @project.progress_percentage
          \%
      = t('projects.goal_completed')
      .row.margin-top-15
        .col-md-4
          %label.control-label
            = t ".team"
          .scrollbar{ style: 'max-height: 450px;' }
            %table.table.table-sm
              %tbody
                %tr
                  %td
                    = @project.thinker.name
                    (
                    %strong.font-italic
                      = t "founder"
                    )
                - @project.team.each do |contribution|
                  %tr
                    %td
                      = contribution.thinker.name
        .col-md-4
          %label.control-label
            = t ".current_goal"
          .scrollbar{ style: 'max-height: 450px;' }
        .col-md-4
          %label.control-label
            = t ".workload_in_time"
          .scrollbar{ style: 'max-height: 450px;' }

- content_for :page_details do
  %ul.list-group.list-group-flush
    %li.list-group-item
      %small.font-weight-bold= t('activerecord.attributes.project.logo')
    %li.list-group-item
      %small.font-weight-bold= t('activerecord.attributes.project.contribution_type')
      %br
      = t("projects.contribution_type.#{@project.contribution_type}")
    %li.list-group-item
      %small.font-weight-bold= t('activerecord.attributes.project.category_id')
      %br
      = t("category.#{@project.category.t_name}")
    %li.list-group-item
      %small.font-weight-bold
        = t('shared.projectsettingsbar.links')
    - if @project.home_url.present?
      = link_to @project.home_url, class: 'list-group-item list-group-item-action' do
        = icon('fas', 'home', t("activerecord.attributes.project.home_url"))
    - if @project.source_code_url.present?
      = link_to @project.source_code_url, class: 'list-group-item list-group-item-action' do
        = icon('fas', 'compact-disc', t("activerecord.attributes.project.source_code_url"))
    - if @project.documentation_url.present?
      = link_to @project.documentation_url, class: 'list-group-item list-group-item-action' do
        = icon('fas', 'book', t("activerecord.attributes.project.documentation_url"))
    - if @project.mailing_list_url.present?
      = link_to @project.mailing_list_url, class: 'list-group-item list-group-item-action' do
        = icon('fas', 'envelope', t("activerecord.attributes.project.mailing_list_url"))

= render partial: 'projects/layout'
