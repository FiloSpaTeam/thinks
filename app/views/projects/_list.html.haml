-# This file is part of Thinks.

-# Thinks is free software: you can redistribute it and/or modify
-# it under the terms of the GNU Affero Public License as published by
-# the Free Software Foundation, either version 3 of the License, or
-# (at your option) any later version.

-# Thinks is distributed in the hope that it will be useful,
-# but WITHOUT ANY WARRANTY; without even the implied warranty of
-# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-# GNU Affero Public License for more details.

-# You should have received a copy of the GNU Affero Public License
-# along with Thinks.  If not, see <http://www.gnu.org/licenses/>.

-# Copyright (c) 2015, Claudio Maradonna

.row
  .col-md-10.col-sm-9.col-xs-12
    = smart_listing_controls_for :projects do
      .input-group.input-group-lg.margin-bottom-15
        .input-group-addon
          %i.fa.fa-search
        = text_field_tag("filters[title_or_description]", filter_value(:title_or_description), class: 'form-control', autocomplete: 'off', placeholder: 'Search title or description')
    .row
      - smart_listing.collection.each_with_index do |project, index|
        .col-lg-3.col-md-4.col-sm-6.col-xs-12
          .panel
            .panel-heading
              = link_to project_path(project) do
                - if project.main_image
                  = cl_image_tag(project.main_image.path, { width: '100%', height: '180' })
                - else
                  %div.bg-info{ style: 'height: 180px; width: 100%;' }
            .panel-body.min-height-200
              = link_to project_path(project) do
                %strong= project.title
                %span.help-block{ style: 'margin-bottom: 0; margin-top: 0;' }
                  = highlights_searched_text(plain_text(project.description.lines.first).truncate(150), filter_value(:title_or_description))
                - if project.category.present?
                  %small
                    %i= t("category.#{project.category.t_name}")

    = smart_listing.paginate

    - if smart_listing.collection.empty?
      - if filter_value(:title_or_description).present?
        = t('.sorry_no_project_found_with', result: filter_value(:title_or_description)).html_safe
      - elsif filter_value(:category_id).present?
        = t('.sorry_no_project_under_category', result: t("category.#{Category.find(filter_value(:category_id)).try(:t_name)}")).html_safe
      = "...but you might be interested in"
      %br
      %br
      .row
        - @five_random_projects.each do |project|
          .col-md-3.col-sm-6.col-xs-12
            .panel
              .panel-heading
                = link_to project_path(project) do
                  - if project.main_image
                    = cl_image_tag(project.main_image.path, { width: '100%', height: '180' })
                  - else
                    .bg-info{ style: 'height: 180px; width: 100%;' }
              .panel-body
                = link_to project_path(project) do
                  %strong= project.title
                  %span.help-block{ style: 'margin-bottom: 0; margin-top: 0;' }
                    = plain_text(project.description.lines.first).truncate(150)

  .col-md-2.col-sm-3.hidden-xs
    %h4
      Categories
    %ul.list-unstyled
      - @categories.each do |category|
        %li{ class: filter_value(:category_id).to_i == category.id ? 'font-italic font-bold' : '' }
          = link_to t("category.#{category.t_name}"), projects_path('filters[category_id]' => category.id)

    %br
    %h4 Sort by
    %ul.list-unstyled
      %li{ class: filter_value(:most_active).present? ? 'font-italic font-bold' : '' }
        = link_to "Most active", projects_path('filters[most_active]' => true)
      %li{ class: filter_value(:most_followed).present? ? 'font-italic font-bold' : '' }
        = link_to "Most followed", projects_path('filters[most_followed]' => true)
      %li{ class: filter_value(:recent).present? ? 'font-italic font-bold' : '' }
        = link_to "Recent", projects_path('filters[recent]' => true)

