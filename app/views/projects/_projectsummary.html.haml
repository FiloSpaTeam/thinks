-# This file is part of Thinks.

-# Thinks is free software: you can redistribute it and/or modify
-# it under the terms of the GNU Affero Public License as published by
-# the Free Software Foundation, either version 3 of the License, or
-# (at your option) any later version.

-# Thinks is distributed in the hope that it will be useful,
-# but WITHOUT ANY WARRANTY; without even the implied warranty of
-# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-# GNU Affero Public License for more details.

-# You should have received a copy of the GNU Affero Public License
-# along with Thinks.  If not, see <http://www.gnu.org/licenses/>.

-# Copyright (c) 2015, Claudio Maradonna

- if thinker_signed_in?
  .panel.panel-default.hidden-xs
    .panel-body
      %strong
        Your contribution
    .list-group
      - if current_thinker != project.thinker
        .list-group-item
          = form_for contribution, url: { controller: :projects, action: :contribute, id: project.id }, html: { id: 'form-contribution' }, method: :put do |f|
            = f.select 'intensity', options_for_select(Contribution.intensities.keys.to_a, contribution.intensity), {}, class: 'form-control', onChange: 'javascript: this.form.submit();'
      - else
        - my_roles = project.assigned_roles.where(thinker: current_thinker).order('team_role_id')
        - my_roles.each do |role|
          .list-group-item
            = t "team_roles.#{role.team_role.t_name}"
.panel.panel-default
  .panel-body
    %strong
      Project
    .progress
      %div{"aria-valuemax" => "100", "aria-valuemin" => "0", "aria-valuenow" => "#{project.progress_percentage}", :class => "progress-bar #{progress_bar_color(project.progress_percentage)}", :role => "progressbar", :style => "min-width: 2em; width: #{project.progress_percentage}%;"}
        = project.progress_percentage
        \%
    = t('projects.list.progress')
  .list-group
    .list-group-item
      founder
      %strong
        = content_tag :span, project.thinker.name, :class => "pull-right"
      - if project.donate_button.present?
        %hr
        .text-center
          = project.donate_button.html_safe
    .list-group-item.hidden-xs
      category
      %strong
        = content_tag :span, project.category.try(:t_name) ? t("category.#{project.category.t_name}") : t('not_defined_yet'), :class => "pull-right"
    .list-group-item.hidden-xs
      license
      %strong
        = content_tag :span, project.license.try(:description) ? project.license.description : t('not_defined_yet'), :class => "pull-right"
    .list-group-item.hidden-xs
      sprint every
      %strong
        = content_tag :span, project.cycle.try(:description) ? project.cycle.description : t('not_defined_yet'), :class => "pull-right"
    .list-group-item.hidden-xs
      minimum team number
      %strong
        = content_tag :span, project.minimum_team_number, :class => "pull-right"
    .list-group-item.hidden-xs
      release date
      %strong
        = content_tag :span, project.release_at.try(:to_s) ? project.release_at.to_s(:long) : t('not_defined_yet'), :class => "pull-right"
  .panel-body.hidden-xs
    %strong
      URLs
  .list-group.hidden-xs
    .list-group-item
      = link_to project.home_url, :class => "pull-right no-padding no-border btn #{!project.home_url.present? ? 'disabled' : ''}", role: "button" do
        = icon('home', :class => "dark-grey")
      website
    .list-group-item
      sources
      = link_to project.source_code_url, :class => "pull-right no-padding no-border btn #{!project.source_code_url.present? ? 'disabled' : ''}", role: "button" do
        = icon('github-alt', :class => "dark-grey")
    .list-group-item
      documentation
      = link_to project.documentation_url, :class => "pull-right no-padding no-border btn #{!project.documentation_url.present? ? 'disabled' : ''}", role: "button" do
        = icon('book', :class => "dark-grey")
  .panel-body.hidden-xs
    %strong
      Summary
  .list-group
    .list-group-item
      - team_number = project.assigned_roles.select(:thinker_id).distinct.count
      = badge(team_number)
      = link_to_if team_number.nonzero?, 'team', project_teams_path(project)
    .list-group-item.hidden-xs
      = badge(project.sprints.size)
      sprints
    .list-group-item.hidden-xs
      = badge(project.goals.size)
      goals
    .list-group-item.hidden-xs
      = badge(project.tasks.size)
      tasks
